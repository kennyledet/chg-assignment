<!doctype html>
<html lang="en">
  <head>
    <base href="http://chegg-tutors.appspot.com/" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/public/styles.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  </head>
  <body>
    <div id="chg-balloon-logo-container">
        <img src="/public/img/logo.png" />
    </div>

    <div id="chg-balloon-controls-container">
        <p>Enter a username to get started!</p>
        <input id="chg-balloon-input" maxlength="2048" placeholder="e.g. BalloonMaster99"
            name="username" autocomplete="off" type="text" value="" />
        <button id="chg-balloon-submit">Check availability</button>
    </div>

    <hr>

    <div id="chg-balloon-results-container">
        
    </div>

    <script type="text/javascript">

        function checkAvailability(usernames, callback) {
            // Accepts a list of string usernames
            var apiUrl = "/coding-challenge/api/user/?username=" + usernames.join(',');

            $.ajax(apiUrl).done(function(data) {
                // Determine availability of each username processed,
                // based on existence in returned data array
                var nonAvailable = [];
                data.forEach(user => { nonAvailable.push(user.username); });

                var result = {
                    available: usernames.filter(username => { return !nonAvailable.includes(username); }),
                    nonAvailable: nonAvailable
                };

                return callback(result);
            });
        }

        // The User search API accepts a comma-separated list of usernames, and returns
        // user data for any matching records

        $.ajax("/coding-challenge/api/user/?username=Hillary2016").done(function(data) {
            // This logs Hillary2016's user data, since the username is registered
            console.log(JSON.stringify(data));
          });

        $.ajax("/coding-challenge/api/user/?username=Trump4Pres,FeelTheBern1").done(function(data) {
            // This logs Trump4Pres's user data, since the username is registered, but
            // no user data for FeelTheBern1, since that username is not currently registered
            console.log(JSON.stringify(data));
          });


        $("#chg-balloon-submit").click(function() {
            var usernameQuery = $("#chg-balloon-input").val();
            console.log(usernameQuery);

            checkAvailability([usernameQuery], function(result) {
                console.log(result);
            });

        });

    </script>

  </body>
</html>